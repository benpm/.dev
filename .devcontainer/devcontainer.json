// For format details, see https://aka.ms/devcontainer.json
// For config options, see https://containers.dev
{
    "name": "C++ LLVM Development",
    "build": {
        "dockerfile": "Dockerfile"
    },

    // VS Code customizations
    "customizations": {
        "vscode": {
            "extensions": [
                // clangd - C/C++ language server (better than Microsoft C++ extension)
                "llvm-vs-code-extensions.vscode-clangd",
                // CodeLLDB - Debugger based on LLDB
                "vadimcn.vscode-lldb",
                // CMake support
                "twxs.cmake",
                "ms-vscode.cmake-tools"
            ],
            "settings": {
                // Use clangd instead of Microsoft IntelliSense
                "C_Cpp.intelliSenseEngine": "disabled",
                // clangd settings
                "clangd.path": "/usr/bin/clangd",
                "clangd.arguments": [
                    "--background-index",
                    "--clang-tidy",
                    "--header-insertion=iwyu",
                    "--completion-style=detailed"
                ],
                // Editor settings for C++
                "editor.formatOnSave": true,
                "[cpp]": {
                    "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
                },
                "[c]": {
                    "editor.defaultFormatter": "llvm-vs-code-extensions.vscode-clangd"
                }
            }
        }
    },

    // Use 'postCreateCommand' to run commands after the container is created
    "postCreateCommand": "clang --version && clangd --version",

    // Run as the default user
    "remoteUser": "vscode"
}
